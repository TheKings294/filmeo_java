<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{base :: layout(~{::body})}">
<head>
    <title>Movie form</title>
</head>

<body class="min-h-screen bg-black">

<!-- Header -->
<div class="border-b border-neutral-800 bg-neutral-950">
    <div class="max-w-4xl mx-auto px-4 md:px-8 py-6">
        <div class="flex items-center gap-4">
            <a th:href="@{/movies}" class="p-2 hover:bg-neutral-800 rounded-lg">
                ‚Üê
            </a>

            <div>
                <h1 class="text-2xl font-bold text-white"
                    th:text="${#lists.isEmpty(movieForm.id) ? 'Create New Movie' : 'Edit Movie'}">
                </h1>
                <p class="text-neutral-400 text-sm">
                    Add or update movie information
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Form -->
<div class="max-w-4xl mx-auto px-4 md:px-8 py-8">
    <form th:action="@{${basePath}(id=${movieId})}"
          th:width="basePath=${editMode ? '/admin/movies/update' + movieId : '/admin/movies/new'}"
          th:object="${movieForm}"
          method="post"
          class="space-y-8">

        <!--The error list-->
        <div th:if="${#fields.hasErrors()}"
             class="bg-red-900/40 border border-red-600 text-red-300 rounded-lg p-4">
            <p class="font-semibold mb-2">Please fix the following errors:</p>
            <ul class="list-disc list-inside text-sm">
                <li th:each="err : ${#fields.errors('*')}"
                    th:text="${err}">
                </li>
            </ul>
        </div>


        <!-- BASIC INFO -->
        <div class="bg-neutral-950 rounded-lg border border-neutral-800 p-6">
            <h2 class="text-xl font-semibold text-white mb-6">Basic Information</h2>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-2">Title *</label>
                    <input type="text"
                           th:field="*{title}"
                           class="w-full bg-neutral-900 text-white px-4 py-3 rounded-lg border border-neutral-800 focus:border-red-600"
                           required>

                    <p th:if="${#fields.hasErrors('title')}"
                       th:errors="*{title}"
                       class="text-red-500 text-sm mt-1">
                    </p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-2">Synopsis</label>
                    <textarea rows="4"
                              th:field="*{resume}"
                              class="w-full bg-neutral-900 text-white px-4 py-3 rounded-lg border border-neutral-800 resize-none"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-2">Poster URL *</label>
                    <input type="url"
                           th:field="*{posterURL}"
                           class="w-full bg-neutral-900 text-white px-4 py-3 rounded-lg border border-neutral-800"
                           required>

                    <p th:if="${#fields.hasErrors('posterURL')}"
                       th:errors="*{posterURL}"
                       class="text-red-500 text-sm mt-1">
                    </p>
                </div>
            </div>
        </div>

        <!-- GENRES -->
        <div class="bg-neutral-950 rounded-lg border border-neutral-800 p-6">
            <h2 class="text-xl font-semibold text-white mb-6">Genres</h2>

            <div class="flex flex-wrap gap-3">
                <label th:each="g : ${genres}"
                       class="cursor-pointer">
                    <input type="checkbox"
                           th:value="${g.id}"
                           th:field="*{genresId}"
                           class="hidden peer">
                    <span
                            class="px-4 py-2 rounded-lg bg-neutral-800 text-neutral-300 peer-checked:bg-red-600 peer-checked:text-white">
                    <span th:text="${g.name}"></span>
                </span>
                </label>

                <p th:if="${#fields.hasErrors('genresId')}"
                   th:errors="*{genresId}"
                   class="text-red-500 text-sm mt-2">
                </p>
            </div>
        </div>

        <!-- DIRECTORS -->
        <div class="bg-neutral-950 rounded-lg border border-neutral-800 p-6">
            <h2 class="text-xl font-semibold text-white mb-6">Directors</h2>

            <div class="space-y-2 max-h-64 overflow-y-auto">
                <label th:each="d : ${directors}"
                       class="flex items-center gap-3 p-3 bg-neutral-900 rounded-lg hover:bg-neutral-800 cursor-pointer">
                    <input type="checkbox"
                           th:value="${d.id}"
                           th:field="*{castingId}"
                           class="w-4 h-4 text-red-600">
                    <span class="text-white"
                          th:text="${d.firstName + ' ' + d.lastName}"></span>
                </label>
            </div>
        </div>

        <!-- STREAMING PLATFORMS -->
        <div class="bg-neutral-950 rounded-lg border border-neutral-800 p-6">
            <h2 class="text-xl font-semibold text-white mb-6">Streaming Platforms</h2>

            <div class="space-y-4"
                 th:each="pm, stat : *{platformMoviesId}">

                <div class="p-4 bg-neutral-900 rounded-lg border border-neutral-800 space-y-3">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-neutral-300 mb-2">Platform</label>
                            <select th:field="*{platformMoviesId[__${stat.index}__].platformId}"
                                    class="w-full bg-neutral-800 text-white px-3 py-2 rounded-lg border border-neutral-700">
                                <option th:each="p : ${platforms}"
                                        th:value="${p.id}"
                                        th:text="${p.name}">
                                </option>
                            </select>

                            <p th:if="${#fields.hasErrors('platformMoviesId[' + stat.index + '].platformId')}"
                               th:errors="*{platformMoviesId[__${stat.index}__].platformId}"
                               class="text-red-500 text-sm">
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm text-neutral-300 mb-2">End Date</label>
                            <input type="date"
                                   th:field="*{platformMoviesId[__${stat.index}__].endDate}"
                                   class="w-full bg-neutral-800 text-white px-3 py-2 rounded-lg border border-neutral-700">

                            <p th:if="${#fields.hasErrors('platformMoviesId[' + stat.index + '].endDate')}"
                               th:errors="*{platformMoviesId[__${stat.index}__].endDate}"
                               class="text-red-500 text-sm">
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIONS -->
        <div class="flex gap-4">
            <button type="submit"
                    class="flex-1 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold">
                Save Movie
            </button>

            <a th:href="@{/admin/movies}"
               class="px-6 py-3 bg-neutral-800 hover:bg-neutral-700 text-white rounded-lg">
                Cancel
            </a>
        </div>

    </form>
</div>

</body>
</html>
